<!DOCTYPE html>
<html>
<head>
    <title>Debug Login Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-group { margin: 10px 0; }
        input { padding: 8px; margin: 5px; width: 200px; }
        button { padding: 10px 20px; margin: 5px; }
        .error { color: red; background: #fee; padding: 10px; margin: 10px 0; }
        .success { color: green; background: #efe; padding: 10px; margin: 10px 0; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Firebase Login Debug Test</h1>
    
    <div id="status">Initializing Firebase...</div>
    <div id="error"></div>
    
    <div id="loginForm" style="display: none;">
        <h2>Test Login</h2>
        <div class="form-group">
            <input type="email" id="email" placeholder="Email" value="quintonndlovu161@gmail.com">
        </div>
        <div class="form-group">
            <input type="password" id="password" placeholder="Password">
        </div>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="testRegister()">Test Register</button>
    </div>
    
    <div id="logs"></div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDlyRXx3aUhmsFx0iON1xDE1qGWorsdztc",
            authDomain: "uncommonattendance.firebaseapp.com",
            projectId: "uncommonattendance",
            storageBucket: "uncommonattendance.firebasestorage.app",
            messagingSenderId: "28326821265",
            appId: "1:28326821265:web:5b44ada2b7cba9a83bae30",
            measurementId: "G-6XGF42V4MH"
        };
        
        let auth, db;
        
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += '<div class="log">' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }
        
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            
            log('‚úÖ Firebase initialized successfully');
            document.getElementById('status').innerHTML = '‚úÖ Firebase ready';
            document.getElementById('loginForm').style.display = 'block';
            
            // Listen for auth state changes
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    log('‚úÖ User signed in: ' + user.email);
                    
                    // Try to get user data from Firestore
                    try {
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        if (userDoc.exists()) {
                            log('‚úÖ User data found in Firestore: ' + JSON.stringify(userDoc.data()));
                        } else {
                            log('‚ö†Ô∏è No user data in Firestore');
                        }
                    } catch (error) {
                        log('‚ùå Error getting user data: ' + error.message);
                    }
                } else {
                    log('‚ÑπÔ∏è User signed out');
                }
            });
            
        } catch (error) {
            log('‚ùå Firebase initialization failed: ' + error.message);
            document.getElementById('error').innerHTML = '<div class="error">Firebase Error: ' + error.message + '</div>';
        }
        
        window.testLogin = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log('üîÑ Attempting login for: ' + email);
            
            try {
                const result = await signInWithEmailAndPassword(auth, email, password);
                log('‚úÖ Login successful: ' + result.user.email);
            } catch (error) {
                log('‚ùå Login failed: ' + error.code + ' - ' + error.message);
                document.getElementById('error').innerHTML = '<div class="error">Login Error: ' + error.message + '</div>';
            }
        }
        
        window.testRegister = async function() {
            const email = 'test' + Date.now() + '@example.com';
            const password = 'testpass123';
            
            log('üîÑ Attempting registration for: ' + email);
            
            try {
                const result = await createUserWithEmailAndPassword(auth, email, password);
                log('‚úÖ Registration successful: ' + result.user.email);
                
                // Create user document
                await setDoc(doc(db, 'users', result.user.uid), {
                    uid: result.user.uid,
                    email: result.user.email,
                    displayName: 'Test User',
                    userType: 'attendee',
                    createdAt: new Date(),
                    photoUrl: null,
                    bio: ''
                });
                
                log('‚úÖ User document created in Firestore');
                
            } catch (error) {
                log('‚ùå Registration failed: ' + error.code + ' - ' + error.message);
                document.getElementById('error').innerHTML = '<div class="error">Registration Error: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>
